<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>viz-components Demo</title>
  <style>
    :root {
      --viz-primary: #0071e3;
      --viz-bg: #ffffff;
      --viz-text: #1d1d1f;
      --viz-accent-purple: #6366f1;
      --viz-accent-cyan: #0d9488;
      --viz-accent-pink: #ec4899;
      --viz-category-web: #3b82f6;
      --viz-category-ai: #8b5cf6;
      --viz-radius: 16px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 2rem;
      background: var(--body-bg, #f5f5f7);
      color: var(--viz-text);
      transition: background 0.3s, color 0.3s;
    }

    h1 {
      text-align: center;
      margin-bottom: 2rem;
    }

    h2 {
      margin-top: 2rem;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--viz-primary);
    }

    .demo-section {
      background: var(--viz-bg);
      padding: 1.5rem;
      border-radius: var(--viz-radius);
      margin-bottom: 1.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .demo-section h3 {
      margin-top: 0;
      color: var(--viz-primary);
    }

    .dark .demo-section {
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    viz-chart, viz-heatmap, viz-treemap {
      height: 350px;
    }

    viz-table {
      max-height: 400px;
    }

    viz-stock-chart {
      height: 600px;
    }

    viz-stock-evolution {
      height: 600px;
    }

    .dark {
      --viz-bg: #1c1c1e;
      --viz-text: #f5f5f7;
      --viz-primary: #0a84ff;
      --body-bg: #000;
    }

    .theme-toggle {
      position: fixed;
      top: 1rem;
      right: 1rem;
      padding: 0.5rem 1rem;
      background: var(--viz-primary);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.875rem;
      z-index: 100;
    }

    .event-log {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      width: 400px;
      max-height: 200px;
      background: var(--viz-bg);
      border: 1px solid var(--viz-primary);
      border-radius: 8px;
      padding: 0.5rem;
      font-size: 0.75rem;
      z-index: 100;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .event-log h4 {
      margin: 0 0 0.5rem 0;
      color: var(--viz-primary);
      display: flex;
      align-items: center;
    }

    .event-log ul {
      margin: 0;
      padding: 0;
      list-style: none;
      max-height: 140px;
      overflow-y: auto;
    }

    .event-log li {
      padding: 0.25rem 0;
      border-bottom: 1px solid rgba(128,128,128,0.2);
      font-family: monospace;
    }

    .event-log .event-name {
      color: var(--viz-accent-purple);
      font-weight: bold;
    }

    .event-log .event-source {
      color: var(--viz-accent-cyan);
    }

    .event-log .event-data {
      color: var(--viz-text);
      opacity: 0.7;
    }

  </style>
</head>
<body>
  <button class="theme-toggle" onclick="document.documentElement.classList.toggle('dark')">
    Toggle Dark Mode
  </button>

  <h1>viz-components Library Demo</h1>

  <!-- Micro Components Section -->
  <h2>Micro Components (Lightweight)</h2>

  <div class="demo-section">
    <h3>Sparklines</h3>
    <p style="color: var(--viz-text); opacity: 0.7; margin-bottom: 1rem;">
      Lightweight inline charts using Canvas - no Highcharts dependency.
    </p>
    <div style="display: flex; gap: 2rem; align-items: center; flex-wrap: wrap;">
      <div>
        <span style="font-size: 0.875rem; opacity: 0.7;">Line:</span>
        <viz-sparkline id="sparkLine" type="line" height="32" style="width: 120px;"></viz-sparkline>
      </div>
      <div>
        <span style="font-size: 0.875rem; opacity: 0.7;">Area:</span>
        <viz-sparkline id="sparkArea" type="area" height="32" style="width: 120px;"></viz-sparkline>
      </div>
      <div>
        <span style="font-size: 0.875rem; opacity: 0.7;">Bar:</span>
        <viz-sparkline id="sparkBar" type="bar" height="32" style="width: 120px;"></viz-sparkline>
      </div>
      <div>
        <span style="font-size: 0.875rem; opacity: 0.7;">With markers:</span>
        <viz-sparkline id="sparkMarkers" type="line" height="32" show-min show-max show-last style="width: 120px;"></viz-sparkline>
      </div>
    </div>
  </div>

  <div class="demo-section">
    <h3>KPI Cards</h3>
    <p style="color: var(--viz-text); opacity: 0.7; margin-bottom: 1rem;">
      Key Performance Indicator cards with value, trend, and optional sparkline.
    </p>
    <viz-dashboard columns="4" gap="16">
      <viz-kpi id="kpi1" label="Revenue" prefix="$" format="compact"></viz-kpi>
      <viz-kpi id="kpi2" label="Conversion" unit="%" decimals="1"></viz-kpi>
      <viz-kpi id="kpi3" label="Bounce Rate" unit="%" decimals="1" invert-trend></viz-kpi>
      <viz-kpi id="kpi4" label="Uptime" unit="%" size="large"></viz-kpi>
    </viz-dashboard>
  </div>

  <div class="demo-section">
    <h3>Status Indicators</h3>
    <p style="color: var(--viz-text); opacity: 0.7; margin-bottom: 1rem;">
      Semantic status indicators with icons and optional pulse animation.
    </p>
    <div style="display: flex; gap: 1.5rem; flex-wrap: wrap;">
      <viz-status status="success" label="API" value="Operational"></viz-status>
      <viz-status status="warning" label="Database" value="High Load" pulse></viz-status>
      <viz-status status="error" label="Cache" value="Down"></viz-status>
      <viz-status status="info" label="Deploy" value="In Progress"></viz-status>
      <viz-status status="neutral" label="Backup" value="Scheduled"></viz-status>
    </div>
  </div>

  <!-- Event Log Panel -->
  <div id="eventLog" class="event-log">
    <h4>Event Log <button onclick="document.getElementById('eventLog').querySelector('ul').innerHTML = ''" style="font-size: 0.75rem; margin-left: 1rem;">Clear</button></h4>
    <ul></ul>
  </div>

  <!-- Stock Chart Section -->
  <h2>Real-Time Stock Chart</h2>

  <div class="demo-section">
    <h3>Live Trading View with Technical Indicators</h3>
    <viz-stock-chart demo config='{"symbol": "AAPL", "realtime": true, "realtimeInterval": 2000}'></viz-stock-chart>
  </div>

  <!-- Stock Evolution Section -->
  <h2>Historical Stock Evolution</h2>

  <div class="demo-section">
    <h3>S&P 500 Historical Performance with Market Events</h3>
    <p style="color: var(--viz-text); opacity: 0.7; margin-bottom: 1rem;">
      Shows simulated S&P 500 data from 2000-2024 with major market events (crashes, rallies, policy changes).
      Click on the flag markers to see event details.
    </p>
    <viz-stock-evolution demo></viz-stock-evolution>
  </div>

  <!-- Charts Section -->
  <h2>Charts</h2>

  <div class="demo-section">
    <h3>Line Chart</h3>
    <viz-chart demo type="line" config='{"title": "Monthly Performance"}'></viz-chart>
  </div>

  <div class="demo-section">
    <h3>Bar Chart</h3>
    <viz-chart demo type="bar" config='{"title": "Sales Data"}'></viz-chart>
  </div>

  <div class="demo-section">
    <h3>Pie Chart</h3>
    <viz-chart id="pieChart" type="pie"></viz-chart>
  </div>

  <!-- Dashboard Section -->
  <h2>Dashboard & Widgets</h2>

  <viz-dashboard columns="3" gap="16">
    <viz-widget title="Revenue" subtitle="Monthly">
      <viz-chart id="widgetChart1" type="area"></viz-chart>
    </viz-widget>
    <viz-widget title="Users" subtitle="Active">
      <viz-chart id="widgetChart2" type="column"></viz-chart>
    </viz-widget>
    <viz-widget title="Performance" subtitle="Score">
      <viz-chart id="widgetChart3" type="line"></viz-chart>
    </viz-widget>
  </viz-dashboard>

  <!-- Table Section -->
  <h2>Data Table</h2>

  <div class="demo-section">
    <h3>Interactive Table with Sorting & Filtering</h3>
    <viz-table id="dataTable"></viz-table>
  </div>

  <!-- Advanced Charts Section -->
  <h2>Advanced Visualizations</h2>

  <div class="demo-section">
    <h3>Heatmap</h3>
    <viz-heatmap demo title="Weekly Activity"></viz-heatmap>
  </div>

  <div class="demo-section">
    <h3>Treemap</h3>
    <viz-treemap demo title="Project Breakdown"></viz-treemap>
  </div>

  <script type="module">
    import { VERSION, VizEventNames } from '../dist/index.js';
    import '../dist/index.js';

    console.log('viz-components version:', VERSION);
    console.log('Available events:', VizEventNames);

    // Event logging helper
    function logEvent(event) {
      const ul = document.querySelector('#eventLog ul');
      const li = document.createElement('li');
      const detail = event.detail;

      li.innerHTML = `
        <span class="event-name">${event.type}</span>
        <span class="event-source">[${detail.source}]</span>
        <span class="event-data">${JSON.stringify(detail.data)}</span>
      `;
      ul.insertBefore(li, ul.firstChild);

      // Keep only last 20 events
      while (ul.children.length > 20) {
        ul.removeChild(ul.lastChild);
      }
    }

    // Listen for all viz events
    document.addEventListener('viz-point-click', logEvent);
    document.addEventListener('viz-series-click', logEvent);
    document.addEventListener('viz-theme-change', logEvent);
    document.addEventListener('viz-sort', logEvent);
    document.addEventListener('viz-filter', logEvent);
    document.addEventListener('viz-select', logEvent);
    document.addEventListener('viz-page', logEvent);

    // Wait for custom elements to be defined
    await Promise.all([
      customElements.whenDefined('viz-chart'),
      customElements.whenDefined('viz-stock-chart'),
      customElements.whenDefined('viz-stock-evolution'),
      customElements.whenDefined('viz-table'),
      customElements.whenDefined('viz-heatmap'),
      customElements.whenDefined('viz-treemap'),
      customElements.whenDefined('viz-sparkline'),
      customElements.whenDefined('viz-kpi'),
      customElements.whenDefined('viz-status'),
    ]);

    // Sparkline data
    const sparkData = [10, 25, 15, 30, 22, 40, 35, 45, 38, 50, 42, 55];
    document.getElementById('sparkLine').data = sparkData;
    document.getElementById('sparkArea').data = sparkData;
    document.getElementById('sparkBar').data = sparkData;
    document.getElementById('sparkMarkers').data = sparkData;

    // KPI data
    const kpi1 = document.getElementById('kpi1');
    kpi1.value = 128450;
    kpi1.previousValue = 115200;
    kpi1.trend = [95, 102, 98, 115, 108, 120, 128];

    const kpi2 = document.getElementById('kpi2');
    kpi2.value = 3.42;
    kpi2.previousValue = 2.98;
    kpi2.trend = [2.1, 2.5, 2.3, 2.8, 3.1, 3.0, 3.4];

    const kpi3 = document.getElementById('kpi3');
    kpi3.value = 42.1;
    kpi3.previousValue = 48.5;
    kpi3.trend = [55, 52, 50, 48, 46, 44, 42];

    const kpi4 = document.getElementById('kpi4');
    kpi4.value = 99.98;
    kpi4.previousValue = 99.95;

    // Pie Chart Data (custom format, not using demo)
    document.getElementById('pieChart').setAttribute('data', JSON.stringify([
      { name: 'Distribution', data: [
        { name: 'Chrome', y: 64.02 },
        { name: 'Safari', y: 18.78 },
        { name: 'Firefox', y: 5.02 },
        { name: 'Edge', y: 4.84 },
        { name: 'Other', y: 7.34 }
      ]}
    ]));
    document.getElementById('pieChart').setAttribute('config', JSON.stringify({
      title: 'Browser Market Share'
    }));

    // Widget Charts (custom data for specific metrics)
    document.getElementById('widgetChart1').setAttribute('data', JSON.stringify([
      { name: 'Revenue', data: [10, 20, 15, 30, 25, 40] }
    ]));
    document.getElementById('widgetChart2').setAttribute('data', JSON.stringify([
      { name: 'Users', data: [150, 200, 180, 250, 220] }
    ]));
    document.getElementById('widgetChart3').setAttribute('data', JSON.stringify([
      { name: 'Score', data: [75, 80, 85, 82, 90, 88] }
    ]));

    // Table Data
    document.getElementById('dataTable').setAttribute('data', JSON.stringify([
      { id: 1, name: 'Alice Johnson', email: 'alice@example.com', role: 'Developer', status: 'Active' },
      { id: 2, name: 'Bob Smith', email: 'bob@example.com', role: 'Designer', status: 'Active' },
      { id: 3, name: 'Carol White', email: 'carol@example.com', role: 'Manager', status: 'Inactive' },
      { id: 4, name: 'David Brown', email: 'david@example.com', role: 'Developer', status: 'Active' },
      { id: 5, name: 'Eve Davis', email: 'eve@example.com', role: 'Designer', status: 'Active' },
      { id: 6, name: 'Frank Miller', email: 'frank@example.com', role: 'Developer', status: 'Inactive' },
      { id: 7, name: 'Grace Wilson', email: 'grace@example.com', role: 'Manager', status: 'Active' },
      { id: 8, name: 'Henry Taylor', email: 'henry@example.com', role: 'Developer', status: 'Active' },
    ]));
    document.getElementById('dataTable').setAttribute('columns', JSON.stringify([
      { key: 'id', header: 'ID', sortable: true, width: '60px' },
      { key: 'name', header: 'Name', sortable: true },
      { key: 'email', header: 'Email', sortable: true },
      { key: 'role', header: 'Role', sortable: true },
      { key: 'status', header: 'Status', sortable: true }
    ]));
    document.getElementById('dataTable').setAttribute('config', JSON.stringify({
      sortable: true,
      filterable: true,
      paginate: true,
      pageSize: 5,
      selectable: true
    }));
  </script>
</body>
</html>
